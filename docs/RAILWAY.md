# Развёртывание веб-версии на Railway

Пошаговая инструкция для публикации «Семейное древо» в интернете через [Railway](https://railway.com).

---

## Шаг 1. Подготовка репозитория

Убедитесь, что проект загружен в **GitHub** (или GitLab):

```bash
git init
git add .
git commit -m "Prepare for Railway"
git remote add origin https://github.com/ВАШ_ЛОГИН/ВАШ_РЕПОЗИТОРИЙ.git
git push -u origin main
```

Файлы `users.json`, `family_tree_*.json` в `.gitignore` — не попадут в репозиторий (это правильно).

---

## Шаг 2. Создание проекта в Railway

1. Откройте https://railway.com/dashboard
2. Нажмите **«New Project»**
3. Выберите **«Deploy from GitHub repo»**
4. Подключите GitHub (если ещё не подключён) и выберите репозиторий
5. Railway сам определит Python и начнёт деплой

---

## Шаг 3. Настройка Root Directory

Railway должен запускать приложение из папки `web`:

1. Откройте проект → ваш сервис
2. Вкладка **Settings** → **Build**
3. В **Root Directory** укажите: `web`
4. Сохраните (Redeploy при необходимости)

---

## Шаг 4. Переменные окружения

В Railway → **Variables** добавьте:

| Переменная | Значение | Обязательно |
|------------|----------|-------------|
| `SECRET_KEY` | Случайная строка (например, сгенерируйте на https://randomkeygen.com) | Да |
| `DATA_DIR` | `/data` | Да (для volume) |

`SECRET_KEY` нужен для сессий. Пример: `a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`.

---

## Шаг 5. Volume для хранения данных

Без Volume данные будут теряться при каждом перезапуске.

1. В проекте Railway нажмите **«+ New»** → **«Volume»**
2. Создайте Volume
3. Подключите его к сервису: **Settings** → **Volumes** → **Add Volume**
4. **Mount Path**: `/data`
5. Redeploy сервиса

---

## Шаг 6. Домен

1. Вкладка **Settings** → **Networking** → **Generate Domain**
2. Railway выдаст URL вида `ваш-проект.up.railway.app`
3. Можно использовать или добавить свой домен

---

## Шаг 7. Проверка

1. Откройте сгенерированный URL
2. Зарегистрируйте пользователя
3. Создайте дерево и убедитесь, что данные сохраняются после обновления страницы

---

## Важно

- **Кнопка «Установить приложение»** на Railway отдаёт ZIP с исходниками (exe там нет).
- **Кнопка «Открыть в приложении»** работает только на Windows с установленным desktop-приложением.
- Для production рекомендуется сменить `SECRET_KEY` на свой уникальный.

---

## Возможные ошибки

| Ошибка | Решение |
|--------|---------|
| Application failed to respond | Проверьте Root Directory = `web`, есть ли Procfile |
| Данные пропадают | Добавлен Volume с mount path `/data` и переменная `DATA_DIR=/data` |
| 500 при регистрации | Проверьте, что Volume примонтирован и приложение имеет права на запись в `/data` |
